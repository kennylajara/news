# Comparación de Entidades

---

## Entidad A (Entidad a Evaluar)

**Nombre:** {{ entity_a_name }}
**Tipo:** {{ entity_a_type }}
**Clasificación actual:** {{ entity_a_classification }}
**Menciones totales:** {{ entity_a_mentions }} (en {{ entity_a_article_count }} artículo{{ 's' if entity_a_article_count != 1 else '' }})

{% if entity_a_context and entity_a_context|length > 0 %}
### Contexto de Uso (Entidad A)

Ejemplos de cómo se usa "{{ entity_a_name }}" en los artículos:

{% for sentence in entity_a_context[:3] %}
{{ loop.index }}. {{ sentence }}
{% endfor %}
{% if entity_a_context|length > 3 %}
... ({{ entity_a_context|length - 3 }} oraciones adicionales omitidas)
{% endif %}
{% else %}
### Contexto de Uso (Entidad A)

No hay suficientes oraciones de contexto disponibles para esta entidad.
{% endif %}

---

## Entidad B (Candidato para Comparación)

**Nombre:** {{ entity_b_name }}
**Tipo:** {{ entity_b_type }}
**Clasificación actual:** {{ entity_b_classification }}
**Menciones totales:** {{ entity_b_mentions }} (en {{ entity_b_article_count }} artículo{{ 's' if entity_b_article_count != 1 else '' }})

{% if entity_b_context and entity_b_context|length > 0 %}
### Contexto de Uso (Entidad B)

Ejemplos de cómo se usa "{{ entity_b_name }}" en los artículos:

{% for sentence in entity_b_context[:3] %}
{{ loop.index }}. {{ sentence }}
{% endfor %}
{% if entity_b_context|length > 3 %}
... ({{ entity_b_context|length - 3 }} oraciones adicionales omitidas)
{% endif %}
{% else %}
### Contexto de Uso (Entidad B)

No hay suficientes oraciones de contexto disponibles para esta entidad.
{% endif %}

---

## Análisis de Co-Ocurrencia

**Artículos compartidos:** {{ shared_articles }} de {{ entity_a_article_count }} artículos donde aparece "{{ entity_a_name }}" ({{ "%.0f"|format((shared_articles / entity_a_article_count * 100) if entity_a_article_count > 0 else 0) }}%)

**Similitud de nombres (Jaccard):** {{ "%.2f"|format(jaccard_similarity) }}

{% if cooccurrence_sentences and cooccurrence_sentences|length > 0 %}
### Oraciones donde Co-Ocurren

Las siguientes oraciones muestran contextos donde AMBAS entidades aparecen juntas:

{% for sentence in cooccurrence_sentences[:3] %}
{{ loop.index }}. {{ sentence }}
{% endfor %}
{% if cooccurrence_sentences|length > 3 %}
... ({{ cooccurrence_sentences|length - 3 }} oraciones adicionales omitidas)
{% endif %}
{% else %}
### Oraciones donde Co-Ocurren

No se encontraron oraciones donde ambas entidades aparecen juntas. Esto podría indicar:
- Son la misma entidad (una es variación de la otra, nunca aparecen simultáneamente)
- Son entidades completamente distintas sin relación
- Datos insuficientes
{% endif %}

---

## Tu Tarea

Analiza la información anterior y determina:

1. **Relación general:** ¿Son la misma entidad (same_entity), entidades diferentes (different_entities), o uso ambiguo (ambiguous_usage)?

2. **Acción para Entidad A ("{{ entity_a_name }}"):**
   - ¿Debe convertirse en ALIAS de B?
   - ¿Debe mantenerse como CANONICAL?
   - ¿Debe marcarse como NOT_AN_ENTITY?
   - ¿No cambiar?

3. **Acción para Entidad B ("{{ entity_b_name }}"):**
   - ¿Debe convertirse en ALIAS de A?
   - ¿Debe mantenerse como CANONICAL?
   - ¿Debe marcarse como NOT_AN_ENTITY?
   - ¿No cambiar?

4. **Confianza:** Del 0.0 al 1.0, ¿qué tan seguro estás de tu evaluación?

5. **Razonamiento:** Explica brevemente (1-3 oraciones) citando evidencia específica del contexto, co-ocurrencia, o patrones de nombres.

---

## Consideraciones Importantes

{% if entity_a_mentions < 5 or entity_b_mentions < 5 %}
⚠️ **Advertencia:** Al menos una entidad tiene pocas menciones ({{ entity_a_mentions }} y {{ entity_b_mentions }}). Sé conservador con el nivel de confianza.
{% endif %}

{% if shared_articles == 0 %}
⚠️ **Advertencia:** Las entidades NO co-ocurren en ningún artículo. Esto dificulta el análisis contextual.
{% endif %}

{% if jaccard_similarity > 0.7 %}
✅ **Nota:** Los nombres son muy similares (similitud {{ "%.0f"|format(jaccard_similarity * 100) }}%). Probablemente son variaciones de la misma entidad.
{% elif jaccard_similarity < 0.3 %}
⚠️ **Nota:** Los nombres son bastante diferentes (similitud {{ "%.0f"|format(jaccard_similarity * 100) }}%). Verifica si hay relación semántica más allá del nombre.
{% endif %}

{% if entity_a_type != entity_b_type %}
⚠️ **Advertencia:** Las entidades tienen tipos diferentes ({{ entity_a_type }} vs {{ entity_b_type }}). Esto podría indicar que son distintas, a menos que el NER haya cometido un error.
{% endif %}
